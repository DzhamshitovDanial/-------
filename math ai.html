<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATH AI | –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–¥—ã –¢–µ—Å—Ç –ñ“Ø–π–µ—Å—ñ</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee; --secondary: #3f37c9; --success: #2ecc71; --error: #e74c3c;
            --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --ai-bg: #f8f9ff;
            --warning: #f39c12; --info: #3498db;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
        header { background: var(--card); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-family: 'Montserrat'; color: var(--primary); font-size: 1.6rem; letter-spacing: 1px; }
        
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .card { background: var(--card); border-radius: 20px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .grade-selector { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .g-btn { padding: 10px 25px; border: 2px solid var(--primary); background: white; border-radius: 30px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .g-btn.active { background: var(--primary); color: white; }

        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .formula-display { background: #f8faff; padding: 30px; border-radius: 15px; font-size: 1.5rem; text-align: center; margin-bottom: 25px; font-weight: bold; color: var(--secondary); border: 1px solid #e0e6ed; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .option { padding: 15px; border: 2px solid #e0e6ed; border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: 500; text-align: center; }
        .option:hover { border-color: var(--primary); background: #f0f3ff; }
        .option.correct { background: var(--success); color: white; border-color: var(--success); }
        .option.wrong { background: var(--error); color: white; border-color: var(--error); }

        /* AI Assistant Styles */
        .ai-assistant { background: var(--ai-bg); border-radius: 15px; padding: 20px; margin-top: 20px; border-left: 5px solid var(--primary); }
        .ai-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .ai-icon { background: var(--primary); color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .ai-title { font-weight: 600; color: var(--secondary); }
        .ai-message { line-height: 1.6; }
        .ai-hint-btn { background: transparent; border: 2px solid var(--primary); color: var(--primary); padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 500; margin-top: 10px; transition: 0.3s; }
        .ai-hint-btn:hover { background: var(--primary); color: white; }
        
        /* Knowledge Graph Styles */
        .knowledge-graph { 
            background: linear-gradient(135deg, #f8f9ff 0%, #eef2ff 100%);
            border-radius: 15px; 
            padding: 20px; 
            margin-top: 25px;
            border: 2px dashed #c1d3ff;
        }
        .kg-header { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 15px; 
            color: var(--secondary);
        }
        .kg-icon { 
            background: var(--info); 
            color: white; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
        }
        .kg-title { 
            font-weight: 700; 
            font-size: 1.1rem; 
        }
        .kg-path { 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            margin-bottom: 15px; 
            flex-wrap: wrap;
        }
        .kg-grade { 
            padding: 6px 12px; 
            background: white; 
            border-radius: 20px; 
            font-size: 0.9rem; 
            border: 2px solid #e0e6ed;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .kg-grade.active { 
            background: var(--info); 
            color: white; 
            border-color: var(--info); 
        }
        .kg-arrow { 
            color: #aaa; 
            font-size: 1.2rem; 
        }
        .kg-micro-lesson { 
            background: white; 
            padding: 15px; 
            border-radius: 12px; 
            margin-top: 15px; 
            border-left: 4px solid var(--warning);
        }
        .kg-micro-lesson h4 { 
            margin-top: 0; 
            color: var(--warning); 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .kg-formula { 
            font-family: monospace; 
            background: #f9f9f9; 
            padding: 10px; 
            border-radius: 8px; 
            margin: 10px 0; 
            border-left: 3px solid var(--primary);
        }
        .kg-visual { 
            display: flex; 
            justify-content: center; 
            margin: 15px 0; 
        }
        .kg-visual-item { 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            text-align: center; 
            border: 2px solid #e0e6ed;
            min-width: 120px;
        }
        .kg-visual-item .grade { 
            font-weight: bold; 
            color: var(--primary); 
            font-size: 1.2rem; 
        }
        .kg-visual-item .topic { 
            font-size: 0.9rem; 
            color: #666; 
            margin-top: 5px; 
        }
        .kg-connection { 
            width: 30px; 
            height: 2px; 
            background: #ddd; 
            align-self: center; 
        }
        
        /* Results and Analysis */
        .results-screen { text-align: center; display: none; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 10px solid var(--primary); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; margin: 20px auto; }
        
        .weakness-analysis { text-align: left; margin-top: 30px; }
        .weakness-item { background: #f8f9ff; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e0e6ed; }
        .weakness-topic { font-weight: 600; color: var(--secondary); margin-bottom: 8px; }
        .practice-question { background: #eef2ff; padding: 15px; border-radius: 10px; margin: 10px 0; font-family: monospace; }
        .solution-steps { margin-top: 10px; padding-left: 20px; }
        .solution-steps li { margin-bottom: 5px; }
        
        .progress-bar { width: 100%; height: 10px; background: #e0e6ed; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }
        
        .btn-restart { margin-top: 20px; padding: 12px 30px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; }
        .btn-show-ai { background: var(--secondary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin-left: 10px; }
        
        /* Retest Styles */
        .retest-banner {
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }
        .retest-banner h3 {
            margin-top: 0;
            color: white;
            font-size: 1.4rem;
        }
        .retest-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        .retest-stat {
            text-align: center;
        }
        .retest-stat .number {
            font-size: 2rem;
            font-weight: bold;
        }
        .retest-stat .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .btn-retest {
            background: white;
            color: var(--primary);
            border: none;
            padding: 12px 35px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-retest:hover {
            background: #f0f3ff;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .options-grid { grid-template-columns: 1fr; }
            .kg-path { flex-direction: column; align-items: flex-start; }
            .kg-arrow { transform: rotate(90deg); margin: 5px 0; }
            .kg-visual { flex-direction: column; align-items: center; gap: 10px; }
            .kg-connection { width: 2px; height: 20px; }
            .retest-stats { flex-direction: column; gap: 15px; }
        }
    </style>
</head>
<body>

<header>
    <div class="logo">MATH.AI</div>
    <div id="stats">–î–∞–Ω–∏–∞–ª –î–∂–∞–º—à–∏—Ç–æ–≤</div>
</header>

<div class="container">
    <div class="grade-selector" id="gradeSelector">
        <button class="g-btn" onclick="startQuiz(9)">9-—Å—ã–Ω—ã–ø</button>
        <button class="g-btn active" onclick="startQuiz(10)">10-—Å—ã–Ω—ã–ø</button>
        <button class="g-btn" onclick="startQuiz(11)">11-—Å—ã–Ω—ã–ø</button>
    </div>

    <div class="card" id="quizCard">
        <div class="quiz-header">
            <span id="topicName">–¢–∞“õ—ã—Ä—ã–ø</span>
            <span id="questionNum">–°“±—Ä–∞“õ: 1/10</span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        
        <div id="questionText" style="font-size: 1.1rem; margin-bottom: 15px;"></div>
        <div class="formula-display" id="mainFormula"></div>
        
        <div class="options-grid" id="options">
            <!-- Options will be inserted here -->
        </div>
        
        <!-- Knowledge Graph Section -->
        <div class="knowledge-graph" id="knowledgeGraph" style="display: none;">
            <div class="kg-header">
                <div class="kg-icon">KG</div>
                <div class="kg-title">–ë—ñ–ª—ñ–º –ì—Ä–∞—Ñ—ã (Knowledge Graph)</div>
            </div>
            
            <div class="kg-path" id="kgPath">
                <!-- Knowledge path will appear here -->
            </div>
            
            <div class="kg-micro-lesson" id="kgMicroLesson">
                <!-- Micro-lesson will appear here -->
            </div>
        </div>
        
        <div class="ai-assistant" id="aiAssistant">
            <div class="ai-header">
                <div class="ai-icon">AI</div>
                <div class="ai-title">Danial AI –ö”©–º–µ–∫—à—ñ—Å—ñ</div>
            </div>
            <div class="ai-message" id="aiMessage">
                –°”ô–ª–µ–º! –ú–µ–Ω —Å–µ–Ω—ñ“£ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ –∫”©–º–µ–∫—à—ñ–Ω—ñ“£–º—ñ–Ω. –°—É—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä—É–¥–µ “õ–∏—ã–Ω–¥—ã“õ —Ç—É—Å–∞, –º–µ–Ω —Å–µ–Ω—ñ“£ –æ–π–ª–∞—É—ã“£–∞ –∂–æ–ª —Å—ñ–ª—Ç–µ–π–º—ñ–Ω.
            </div>
            <button class="ai-hint-btn" onclick="getHint()">–ö”©–º–µ–∫ –∞–ª—É</button>
        </div>
    </div>

    <div class="card results-screen" id="resultsCard">
        <h2>–¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª–¥—ã!</h2>
        <div class="score-circle" id="finalScore">0/10</div>
        <p id="resultMessage">–ö–µ—Ä–µ–º–µ—Ç –Ω”ô—Ç–∏–∂–µ!</p>
        
        <div class="weakness-analysis" id="weaknessAnalysis">
            <h3>”ò–ª—Å—ñ–∑ –∂–µ—Ä–ª–µ—Ä–¥—ñ —Ç–∞–ª–¥–∞—É:</h3>
            <div id="weaknessList">
                <!-- Weakness analysis will appear here -->
            </div>
        </div>
        
        <!-- Retest Banner -->
        <div class="retest-banner" id="retestBanner" style="display: none;">
            <h3>üéØ “ö–∞—Ç–µ–ª–µ—Ä –±–æ–π—ã–Ω—à–∞ “õ–æ—Å—ã–º—à–∞ —Ç–µ—Å—Ç</h3>
            <p>–°—ñ–∑ –±—ñ–ª—ñ–º—ñ–Ω —Ç–µ—Ä–µ“£–¥–µ—Ç—É –∂”ô–Ω–µ “õ–∞—Ç–µ–ª–µ—Ä–¥—ñ —Ç“Ø–∑–µ—Ç—É “Ø—à—ñ–Ω “õ–æ—Å—ã–º—à–∞ —Ç–µ—Å—Ç –∂–∞—Å–∞–π –∞–ª–∞—Å—ã–∑.</p>
            
            <div class="retest-stats">
                <div class="retest-stat">
                    <div class="number" id="wrongQuestionsCount">0</div>
                    <div class="label">“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä</div>
                </div>
                <div class="retest-stat">
                    <div class="number" id="weakTopicsCount">0</div>
                    <div class="label">”ò–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä</div>
                </div>
                <div class="retest-stat">
                    <div class="number">~5 –º–∏–Ω</div>
                    <div class="label">–£–∞“õ—ã—Ç “õ–∞–∂–µ—Ç</div>
                </div>
            </div>
            
            <button class="btn-retest" onclick="startRetest()">“ö–∞—Ç–µ–ª–µ—Ä –±–æ–π—ã–Ω—à–∞ —Ç–µ—Å—Ç—Ç—ñ –±–∞—Å—Ç–∞—É</button>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">–ë“±–ª —Ç–µ—Å—Ç —Å—ñ–∑–¥—ñ“£ —Ç–µ–∫ “õ–∞—Ç–µ–ª–µ—Å–∫–µ–Ω —Å“±—Ä–∞“õ—Ç–∞—Ä—ã“£—ã–∑–¥–∞–Ω “õ“±—Ä–∞–ª–∞–¥—ã</p>
        </div>
        
        <button class="btn-restart" onclick="location.reload()">“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
    </div>
</div>

<script>
// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∫–ª–∞—Å—Å–∞–º
const knowledgeGraph = {
    "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è": {
        prerequisites: [
            { grade: 8, topic: "–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞", connection: "sin¬≤x + cos¬≤x = 1 —à—ã“ì–∞–¥—ã" },
            { grade: 9, topic: "–¢—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à", connection: "sin, cos, tan –∞–Ω—ã“õ—Ç–∞–º–∞–ª–∞—Ä—ã" },
            { grade: 9, topic: "–ë“±—Ä—ã—à—Ç–∞—Ä–¥—ã“£ ”©–ª—à–µ–º—ñ", connection: "–≥—Ä–∞–¥—É—Å/—Ä–∞–¥–∏–∞–Ω" }
        ],
        microLesson: `
            <h4>üéØ –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ (8-9 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ —Ç“Ø—Å—ñ–Ω—ñ–∫:</strong> –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è - —Ç—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç—ã“£ “õ–∞–±—ã—Ä“ì–∞–ª–∞—Ä—ã –º–µ–Ω –±“±—Ä—ã—à—Ç–∞—Ä—ã –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã –∑–µ—Ä—Ç—Ç–µ–π–¥—ñ.</p>
            
            <div class="kg-visual">
                <div class="kg-visual-item">
                    <div class="grade">8 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞</div>
                    <div style="font-size: 2rem;">a¬≤ + b¬≤ = c¬≤</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">9 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">sin, cos, tan</div>
                    <div>sin = “õ–∞—Ä—Å—ã/–≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">10 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">sin¬≤x + cos¬≤x = 1</div>
                    <div>–ù–µ–≥—ñ–∑–≥—ñ —Å”ô–π–∫–µ—Å—Ç—ñ–∫</div>
                </div>
            </div>
            
            <div class="kg-formula">sin¬≤Œ∏ + cos¬≤Œ∏ = 1 (–ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã–Ω–∞–Ω —à—ã“ì–∞–¥—ã)</div>
            <p><strong>“ö–∞–ª–∞–π —à—ã“ì–∞–¥—ã?</strong> –¢—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç–∞:</p>
            <p>1) sin Œ∏ = “õ–∞—Ä—Å—ã/–≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞ = a/c</p>
            <p>2) cos Œ∏ = —ñ—Ä–≥–µ–ª–µ—Å/–≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞ = b/c</p>
            <p>3) sin¬≤Œ∏ + cos¬≤Œ∏ = (a/c)¬≤ + (b/c)¬≤ = (a¬≤ + b¬≤)/c¬≤ = c¬≤/c¬≤ = 1</p>
            <p><strong>‚úÖ –ù”ô—Ç–∏–∂–µ:</strong> sin¬≤x + cos¬≤x = 1 - –±“±–ª –ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã–Ω—ã“£ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ —Ç“Ø—Ä—ñ!</p>
        `
    },
    "–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É": {
        prerequisites: [
            { grade: 7, topic: "–ö”©–±–µ–π—Ç–∫—ñ—à—Ç–µ—Ä–≥–µ –∂—ñ–∫—Ç–µ—É", connection: "a¬≤ - b¬≤ = (a-b)(a+b)" },
            { grade: 8, topic: "–ö–≤–∞–¥—Ä–∞—Ç —Ç“Ø–±—ñ—Ä", connection: "x¬≤ = a ‚áí x = ¬±‚àöa" },
            { grade: 9, topic: "–î–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç", connection: "D = b¬≤ - 4ac" }
        ],
        microLesson: `
            <h4>üéØ –ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ (7-9 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>1. –ö”©–±–µ–π—Ç–∫—ñ—à—Ç–µ—Ä–≥–µ –∂—ñ–∫—Ç–µ—É (7 —Å—ã–Ω—ã–ø):</strong></p>
            <div class="kg-formula">a¬≤ - b¬≤ = (a - b)(a + b)</div>
            <p><strong>–ú—ã—Å–∞–ª:</strong> x¬≤ - 25 = (x - 5)(x + 5)</p>
            
            <p><strong>2. –ö–≤–∞–¥—Ä–∞—Ç —Ç“Ø–±—ñ—Ä (8 —Å—ã–Ω—ã–ø):</strong></p>
            <div class="kg-formula">–ï–≥–µ—Ä x¬≤ = a –±–æ–ª—Å–∞, –æ–Ω–¥–∞ x = ‚àöa –Ω–µ–º–µ—Å–µ x = -‚àöa</div>
            <p><strong>–ú—ã—Å–∞–ª:</strong> x¬≤ = 9 ‚áí x = 3 –Ω–µ–º–µ—Å–µ x = -3</p>
            
            <p><strong>3. –¢–æ–ª—ã“õ –∫–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É (9 —Å—ã–Ω—ã–ø):</strong></p>
            <div class="kg-formula">ax¬≤ + bx + c = 0</div>
            <div class="kg-formula">D = b¬≤ - 4ac</div>
            <div class="kg-formula">–ï–≥–µ—Ä D > 0 –±–æ–ª—Å–∞: x = (-b ¬± ‚àöD)/(2a)</div>
        `
    },
    "–õ–æ–≥–∞—Ä–∏—Ñ–º": {
        prerequisites: [
            { grade: 9, topic: "–î”ô—Ä–µ–∂–µ–ª–µ—Ä", connection: "a‚Åø = b ‚áí log‚Çêb = n" },
            { grade: 10, topic: "–ö”©—Ä—Å–µ—Ç–∫—ñ—à—Ç—ñ–∫ —Ñ—É–Ω–∫—Ü–∏—è", connection: "y = aÀ£" }
        ],
        microLesson: `
            <h4>üéØ –õ–æ–≥–∞—Ä–∏—Ñ–º –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ (9-10 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ —Ç“Ø—Å—ñ–Ω—ñ–∫:</strong> –õ–æ–≥–∞—Ä–∏—Ñ–º - –¥”ô—Ä–µ–∂–µ–Ω—ñ“£ –∫–µ—Ä—ñ –∞–º–∞–ª—ã.</p>
            
            <div class="kg-visual">
                <div class="kg-visual-item">
                    <div class="grade">9 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–î”ô—Ä–µ–∂–µ–ª–µ—Ä</div>
                    <div>2¬≥ = 8</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">10 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–õ–æ–≥–∞—Ä–∏—Ñ–º</div>
                    <div>log‚ÇÇ8 = 3</div>
                </div>
            </div>
            
            <p><strong>–ê–Ω—ã“õ—Ç–∞–º–∞:</strong></p>
            <div class="kg-formula">–ï–≥–µ—Ä aÀ£ = b –±–æ–ª—Å–∞, –æ–Ω–¥–∞ log‚Çêb = x</div>
            
            <p><strong>–ú—ã—Å–∞–ª–¥–∞—Ä:</strong></p>
            <p>1) 2‚Å¥ = 16 ‚áí log‚ÇÇ16 = 4</p>
            <p>2) 10¬≤ = 100 ‚áí log‚ÇÅ‚ÇÄ100 = 2</p>
            <p>3) 5¬≤ = 25 ‚áí log‚ÇÖ25 = 2</p>
            
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ “õ–∞—Å–∏–µ—Ç:</strong></p>
            <div class="kg-formula">log‚Çê(aÀ£) = x</div>
            <div class="kg-formula">a^(log‚Çêx) = x</div>
        `
    },
    "–¢—É—ã–Ω–¥—ã": {
        prerequisites: [
            { grade: 9, topic: "–§—É–Ω–∫—Ü–∏—è “±“ì—ã–º—ã", connection: "y = f(x)" },
            { grade: 10, topic: "–§—É–Ω–∫—Ü–∏—è —à–µ–≥—ñ", connection: "lim Œîx‚Üí0" },
            { grade: 10, topic: "”®–∑–≥–µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã", connection: "Œîy/Œîx" }
        ],
        microLesson: `
            <h4>üéØ –¢—É—ã–Ω–¥—ã –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ (9-10 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>–§–∏–∑–∏–∫–∞–ª—ã“õ –º–∞“ì—ã–Ω–∞—Å—ã:</strong> –¢—É—ã–Ω–¥—ã - —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã“£ ”©–∑–≥–µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã.</p>
            
            <div class="kg-visual">
                <div class="kg-visual-item">
                    <div class="grade">9 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–§—É–Ω–∫—Ü–∏—è</div>
                    <div>y = f(x)</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">10 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–®–µ–∫</div>
                    <div>lim Œîx‚Üí0</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">11 —Å—ã–Ω—ã–ø</div>
                    <div class="topic">–¢—É—ã–Ω–¥—ã</div>
                    <div>f'(x)</div>
                </div>
            </div>
            
            <p><strong>–ê–Ω—ã“õ—Ç–∞–º–∞:</strong></p>
            <div class="kg-formula">f'(x) = lim<sub>Œîx‚Üí0</sub> [f(x+Œîx) - f(x)]/Œîx</div>
            
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä:</strong></p>
            <div class="kg-formula">(x‚Åø)' = n¬∑x‚Åø‚Åª¬π</div>
            <p><strong>–ú—ã—Å–∞–ª:</strong> (x¬≥)' = 3x¬≤</p>
            
            <div class="kg-formula">(const)' = 0</div>
            <p><strong>–ú—ã—Å–∞–ª:</strong> (5)' = 0</div>
        `
    },
    "–ò–Ω—Ç–µ–≥—Ä–∞–ª": {
        prerequisites: [
            { grade: 11, topic: "–¢—É—ã–Ω–¥—ã", connection: "–ò–Ω—Ç–µ–≥—Ä–∞–ª - —Ç—É—ã–Ω–¥—ã“ì–∞ –∫–µ—Ä—ñ –∞–º–∞–ª" },
            { grade: 10, topic: "–ê—É–¥–∞–Ω –µ—Å–µ–ø—Ç–µ—É", connection: "–ò–Ω—Ç–µ–≥—Ä–∞–ª - –∞—É–¥–∞–Ω–¥—ã –µ—Å–µ–ø—Ç–µ—É" }
        ],
        microLesson: `
            <h4>üéØ –ò–Ω—Ç–µ–≥—Ä–∞–ª –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ (10-11 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ –∏–¥–µ—è:</strong> –ò–Ω—Ç–µ–≥—Ä–∞–ª - —Ç—É—ã–Ω–¥—ã“ì–∞ –∫–µ—Ä—ñ –∞–º–∞–ª.</p>
            
            <div class="kg-visual">
                <div class="kg-visual-item">
                    <div class="grade">–¢—É—ã–Ω–¥—ã</div>
                    <div class="topic">f(x) ‚Üí f'(x)</div>
                    <div>”®–∑–≥–µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã</div>
                </div>
                <div class="kg-connection"></div>
                <div class="kg-visual-item">
                    <div class="grade">–ò–Ω—Ç–µ–≥—Ä–∞–ª</div>
                    <div class="topic">f'(x) ‚Üí f(x)</div>
                    <div>–ê—É–¥–∞–Ω/–∫”©–ª–µ–º</div>
                </div>
            </div>
            
            <p><strong>–ì–µ–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ –º–∞“ì—ã–Ω–∞—Å—ã:</strong> –ò–Ω—Ç–µ–≥—Ä–∞–ª - “õ–∏—Å—ã“õ —Å—ã–∑—ã“õ—Ç—ã“£ –∞—Å—Ç—ã–Ω–¥–∞“ì—ã –∞—É–¥–∞–Ω.</p>
            <p><strong>–ù–µ–≥—ñ–∑–≥—ñ —Ñ–æ—Ä–º—É–ª–∞:</strong></p>
            <div class="kg-formula">‚à´ x‚Åø dx = x‚Åø‚Å∫¬π/(n+1) + C (–µ–≥–µ—Ä n ‚â† -1)</div>
            
            <p><strong>–ú—ã—Å–∞–ª–¥–∞—Ä:</strong></p>
            <p>1) ‚à´ 1 dx = x + C</p>
            <p>2) ‚à´ x dx = x¬≤/2 + C</p>
            <p>3) ‚à´ 2x dx = x¬≤ + C</p>
            
            <p><strong>–¢“±—Ä–∞“õ—Ç—ã –°:</strong> –ë“±–ª –∏–Ω—Ç–µ–≥—Ä–∞–ª–¥–∞—É —Ç“±—Ä–∞“õ—Ç—ã—Å—ã. ”ò—Ä —Ç“Ø—Ä–ª—ñ —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä–¥—ã“£ —Ç—É—ã–Ω–¥—ã—Å—ã –±—ñ—Ä–¥–µ–π –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.</p>
        `
    },
    "“ö—ã—Å“õ–∞—à–∞ –∫”©–±–µ–π—Ç—É": {
        prerequisites: [
            { grade: 7, topic: "–ö”©–±–µ–π—Ç—É–¥—ñ“£ “Ø–ª–µ—Å—Ç—ñ—Ä—ñ–º–¥—ñ–ª—ñ–∫ “õ–∞—Å–∏–µ—Ç—ñ", connection: "(a+b)(c+d)" },
            { grade: 8, topic: "–ö”©–ø–º“Ø—à–µ–ª–µ—Ä", connection: "–ö”©–ø–º“Ø—à–µ–ª–µ—Ä–¥—ñ –∫”©–±–µ–π—Ç—É" }
        ],
        microLesson: `
            <h4>üéØ “ö—ã—Å“õ–∞—à–∞ –∫”©–±–µ–π—Ç—É —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä—ã (7-8 —Å—ã–Ω—ã–ø—Ç–∞—Ä)</h4>
            <p><strong>1. “ö–æ—Å—ã–Ω–¥—ã–Ω—ã“£ –∫–≤–∞–¥—Ä–∞—Ç—ã:</strong></p>
            <div class="kg-formula">(a + b)¬≤ = a¬≤ + 2ab + b¬≤</div>
            <p><strong>–ì–µ–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä—É:</strong> “ö–∞–±—ã—Ä“ì–∞—Å—ã (a+b) –±–æ–ª–∞—Ç—ã–Ω —à–∞—Ä—à—ã–Ω—ã“£ –∞—É–¥–∞–Ω—ã.</p>
            
            <p><strong>2. –ê–π—ã—Ä–º–∞–Ω—ã“£ –∫–≤–∞–¥—Ä–∞—Ç—ã:</strong></p>
            <div class="kg-formula">(a - b)¬≤ = a¬≤ - 2ab + b¬≤</div>
            
            <p><strong>3. –ö–≤–∞–¥—Ä–∞—Ç—Ç–∞—Ä –∞–π—ã—Ä–º–∞—Å—ã:</strong></p>
            <div class="kg-formula">a¬≤ - b¬≤ = (a - b)(a + b)</div>
            
            <p><strong>–ï—Å–∫–µ —Å–∞“õ—Ç–∞—É ”ô–¥—ñ—Å—ñ:</strong> "–ë—ñ—Ä—ñ–Ω—à—ñ–Ω—ñ“£ –∫–≤–∞–¥—Ä–∞—Ç—ã, –ø–ª—é—Å –µ–∫—ñ –µ—Å–µ –∫”©–±–µ–π—Ç—ñ–Ω–¥—ñ, –ø–ª—é—Å –µ–∫—ñ–Ω—à—ñ–Ω—ñ“£ –∫–≤–∞–¥—Ä–∞—Ç—ã"</p>
        `
    }
};

// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
const db = {
    9: [
        {q: "x¬≤ - 25 = 0", o: ["x=5", "x=-5; 5", "x=0", "x=25"], a: 1, t: "–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É"},
        {q: "3x - 12 = 0", o: ["4", "3", "-4", "12"], a: 0, t: "–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É"},
        {q: "(a+b)¬≤ –Ω–µ–≥–µ —Ç–µ“£?", o: ["a¬≤+b¬≤", "a¬≤+2ab+b¬≤", "a¬≤-b¬≤", "2a+2b"], a: 1, t: "“ö—ã—Å“õ–∞—à–∞ –∫”©–±–µ–π—Ç—É"},
        {q: "‚àö144 –Ω–µ–≥–µ —Ç–µ“£?", o: ["14", "11", "12", "16"], a: 2, t: "–¢“Ø–±—ñ—Ä–ª–µ—Ä"},
        {q: "–ê—Ä–∏—Ñ–º. –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è: a‚ÇÅ=5, d=2. a‚ÇÉ —Ç–∞–ø.", o: ["7", "9", "11", "5"], a: 1, t: "–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è"},
        {q: "–î”©“£–≥–µ–ª–µ–∫—Ç—ñ“£ –∞—É–¥–∞–Ω—ã:", o: ["2œÄr", "œÄr¬≤", "bh", "a¬≤"], a: 1, t: "–ì–µ–æ–º–µ—Ç—Ä–∏—è"},
        {q: "sin 30¬∞ –Ω–µ–≥–µ —Ç–µ“£?", o: ["1/2", "‚àö3/2", "1", "0"], a: 0, t: "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è"},
        {q: "|-5| + |3|", o: ["-2", "2", "8", "-8"], a: 2, t: "–ú–æ–¥—É–ª—å"},
        {q: "–¢—ñ–∫—Ç”©—Ä—Ç–±“±—Ä—ã—à: a=4, b=5. P=?", o: ["20", "9", "18", "10"], a: 2, t: "–ü–µ—Ä–∏–º–µ—Ç—Ä"},
        {q: "2¬≥ * 2¬≤ –Ω–µ–≥–µ —Ç–µ“£?", o: ["2‚Å∂", "2‚Åµ", "4‚Åµ", "32"], a: 1, t: "–î”ô—Ä–µ–∂–µ"}
    ],
    10: [
        {q: "sin¬≤x + cos¬≤x", o: ["0", "2", "1", "sin x"], a: 2, t: "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è"},
        {q: "log‚ÇÇ 16", o: ["2", "8", "4", "16"], a: 2, t: "–õ–æ–≥–∞—Ä–∏—Ñ–º"},
        {q: "cos 60¬∞", o: ["1/2", "‚àö2/2", "‚àö3/2", "0"], a: 0, t: "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è"},
        {q: "log‚ÇÉ x = 2", o: ["6", "9", "5", "3"], a: 1, t: "–õ–æ–≥–∞—Ä–∏—Ñ–º–¥—ñ–∫ —Ç–µ“£–¥–µ—É"},
        {q: "tg Œ± * ctg Œ±", o: ["0", "1", "-1", "sin Œ±"], a: 1, t: "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è"},
        {q: "5À£ = 125", o: ["2", "3", "5", "25"], a: 1, t: "–ö”©—Ä—Å–µ—Ç–∫—ñ—à—Ç—ñ–∫ —Ç–µ“£–¥–µ—É"},
        {q: "sin(-Œ±) –Ω–µ–≥–µ —Ç–µ“£?", o: ["sin Œ±", "-sin Œ±", "cos Œ±", "0"], a: 1, t: "–§—É–Ω–∫—Ü–∏—è “õ–∞—Å–∏–µ—Ç—ñ"},
        {q: "2 log‚ÇÇ 5", o: ["log‚ÇÇ 10", "log‚ÇÇ 25", "5", "10"], a: 1, t: "–õ–æ–≥–∞—Ä–∏—Ñ–º “õ–∞—Å–∏–µ—Ç—ñ"},
        {q: "Arcsin(1/2)", o: ["30¬∞", "60¬∞", "45¬∞", "90¬∞"], a: 0, t: "–ö–µ—Ä—ñ —Ñ—É–Ω–∫—Ü–∏—è"},
        {q: "cos¬≤x - sin¬≤x", o: ["1", "cos 2x", "sin 2x", "0"], a: 1, t: "“ö–æ—Å –±“±—Ä—ã—à"}
    ],
    11: [
        {q: "(x¬≤)' —Ç—É—ã–Ω–¥—ã—Å—ã:", o: ["x", "2x", "2", "x¬≤"], a: 1, t: "–¢—É—ã–Ω–¥—ã"},
        {q: "‚à´ 1 dx", o: ["x + C", "0", "1", "C"], a: 0, t: "–ò–Ω—Ç–µ–≥—Ä–∞–ª"},
        {q: "(sin x)'", o: ["cos x", "-cos x", "tg x", "1"], a: 0, t: "–¢—É—ã–Ω–¥—ã"},
        {q: "lim (x‚Üí2) x¬≤", o: ["2", "4", "0", "‚àû"], a: 1, t: "–®–µ–∫—Ç–µ—Ä"},
        {q: "(eÀ£)'", o: ["eÀ£", "xeÀ£‚Åª¬π", "1", "0"], a: 0, t: "–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞"},
        {q: "‚à´ 2x dx", o: ["x¬≤ + C", "2 + C", "x + C", "2x¬≤"], a: 0, t: "–ò–Ω—Ç–µ–≥—Ä–∞–ª"},
        {q: "(ln x)'", o: ["eÀ£", "1/x", "x", "1"], a: 1, t: "–õ–æ–≥–∞—Ä–∏—Ñ–º —Ç—É—ã–Ω–¥—ã—Å—ã"},
        {q: "lim (x‚Üí‚àû) 1/x", o: ["‚àû", "1", "0", "-1"], a: 2, t: "–®–µ–∫—Ç–µ—Ä"},
        {q: "(const)' –Ω–µ–≥–µ —Ç–µ“£?", o: ["1", "const", "0", "x"], a: 2, t: "–¢—É—ã–Ω–¥—ã"},
        {q: "f(x)=3x. f'(2)=?", o: ["3", "6", "2", "0"], a: 0, t: "–¢—É—ã–Ω–¥—ã –º”ô–Ω—ñ"}
    ]
};

let currentGrade = 10;
let currentIndex = 0;
let score = 0;
let canClick = true;
let wrongAnswers = [];
let knowledgeGraphVisible = false;

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–µ—Ç–µ—Å—Ç–∞
let retestMode = false;
let retestQuestions = [];
let retestCurrentIndex = 0;
let retestScore = 0;

function startQuiz(grade) {
    currentGrade = grade;
    currentIndex = 0;
    score = 0;
    canClick = true;
    wrongAnswers = [];
    knowledgeGraphVisible = false;
    retestMode = false;
    
    document.getElementById('quizCard').style.display = 'block';
    document.getElementById('resultsCard').style.display = 'none';
    document.getElementById('knowledgeGraph').style.display = 'none';
    document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('aiMessage').innerHTML = 
        "–°”ô–ª–µ–º! –ú–µ–Ω —Å–µ–Ω—ñ“£ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ –∫”©–º–µ–∫—à—ñ–Ω—ñ“£–º—ñ–Ω. –°—É—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä—É–¥–µ “õ–∏—ã–Ω–¥—ã“õ —Ç—É—Å–∞, –º–µ–Ω —Å–µ–Ω—ñ“£ –æ–π–ª–∞—É—ã“£–∞ –∂–æ–ª —Å—ñ–ª—Ç–µ–π–º—ñ–Ω.";
    
    showQuestion();
}

function showQuestion() {
    canClick = true;
    knowledgeGraphVisible = false;
    document.getElementById('knowledgeGraph').style.display = 'none';
    
    let data;
    if (retestMode) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å –∏–∑ —Ä–µ—Ç–µ—Å—Ç–∞
        data = retestQuestions[retestCurrentIndex];
        document.getElementById('topicName').innerText = data.t;
        document.getElementById('questionNum').innerText = `“ö–∞—Ç–µ–ª–µ—Ä —Ç–µ—Å—Ç—ñ: ${retestCurrentIndex + 1}/${retestQuestions.length}`;
        document.getElementById('mainFormula').innerText = data.q;
        document.getElementById('progressFill').style.width = `${((retestCurrentIndex + 1) / retestQuestions.length) * 100}%`;
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å
        data = db[currentGrade][currentIndex];
        document.getElementById('topicName').innerText = data.t;
        document.getElementById('questionNum').innerText = `–°“±—Ä–∞“õ: ${currentIndex + 1}/10`;
        document.getElementById('mainFormula').innerText = data.q;
        document.getElementById('progressFill').style.width = `${(currentIndex + 1) * 10}%`;
    }
    
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = '';
    
    data.o.forEach((opt, idx) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerText = opt;
        div.onclick = () => check(idx, div);
        optionsDiv.appendChild(div);
    });
    
    // Update AI assistant with basic hint
    updateAIHint(data.t);
}

function updateAIHint(topic) {
    const hint = getBasicHint(topic);
    document.getElementById('aiMessage').innerHTML = 
        `<strong>${topic}</strong> —Ç–∞“õ—ã—Ä—ã–±—ã –±–æ–π—ã–Ω—à–∞ –∫–µ“£–µ—Å:<br>${hint}`;
}

function getBasicHint(topic) {
    const hints = {
        "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è": "sin¬≤x + cos¬≤x = 1 –µ–∫–µ–Ω—ñ–Ω –µ—Å—Ç–µ —Å–∞“õ—Ç–∞. –ë“±–ª –ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã–Ω–∞–Ω —à—ã“ì–∞–¥—ã.",
        "–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É": "x¬≤ = a –±–æ–ª—Å–∞, x = ¬±‚àöa. –ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É–¥—ñ“£ –µ–∫—ñ —Ç“Ø–±—ñ—Ä—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.",
        "–õ–æ–≥–∞—Ä–∏—Ñ–º": "log‚Çê b = c –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ a·∂ú = b. –ú—ã—Å–∞–ª—ã, log‚ÇÇ 8 = 3, —Å–µ–±–µ–±—ñ 2¬≥ = 8.",
        "–¢—É—ã–Ω–¥—ã": "(x‚Åø)' = n¬∑x‚Åø‚Åª¬π —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω “õ–æ–ª–¥–∞–Ω. –ú—ã—Å–∞–ª—ã, (x¬≤)' = 2x.",
        "–ò–Ω—Ç–µ–≥—Ä–∞–ª": "‚à´ x‚Åø dx = x‚Åø‚Å∫¬π/(n+1) + C. –ú—ã—Å–∞–ª—ã, ‚à´ 1 dx = x + C.",
        "“ö—ã—Å“õ–∞—à–∞ –∫”©–±–µ–π—Ç—É": "(a+b)¬≤ = a¬≤ + 2ab + b¬≤. “ö–æ—Å—ã–Ω–¥—ã–Ω—ã“£ –∫–≤–∞–¥—Ä–∞—Ç—ã —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω –µ—Å—Ç–µ —Å–∞“õ—Ç–∞."
    };
    
    return hints[topic] || "–§–æ—Ä–º—É–ª–∞–ª–∞—Ä–¥—ã “õ–æ–ª–¥–∞–Ω—ã–ø, –º”ô—Å–µ–ª–µ–Ω—ñ “õ–∞–¥–∞–º-“õ–∞–¥–∞–º —à–µ—à—ñ–ø –∫”©—Ä.";
}

function showKnowledgeGraph(topic, isCorrect) {
    const kgData = knowledgeGraph[topic];
    if (!kgData) return;
    
    knowledgeGraphVisible = true;
    const kgElement = document.getElementById('knowledgeGraph');
    kgElement.style.display = 'block';
    
    // Build knowledge path
    const pathHtml = kgData.prerequisites.map((preq, index) => {
        const isLast = index === kgData.prerequisites.length - 1;
        return `
            <div class="kg-grade ${isLast ? 'active' : ''}">
                <span>${preq.grade} —Å—ã–Ω—ã–ø</span>
                <span style="font-size: 0.8rem; color: #666;">${preq.topic}</span>
            </div>
            ${!isLast ? '<div class="kg-arrow">‚Üí</div>' : ''}
        `;
    }).join('');
    
    document.getElementById('kgPath').innerHTML = pathHtml;
    
    // Build micro-lesson
    let microLessonHtml = kgData.microLesson;
    
    if (!isCorrect) {
        microLessonHtml += `
            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; border-left: 4px solid var(--warning);">
                <strong>‚ö†Ô∏è –ù–µ–ª—ñ–∫—Ç–µ–Ω “õ–∞—Ç–µ–ª–µ—Å—Ç—ñ“£?</strong>
                <p>–ú“Ø–º–∫—ñ–Ω —Å—ñ–∑ ${kgData.prerequisites[0].grade} —Å—ã–Ω—ã–ø—Ç–∞“ì—ã "${kgData.prerequisites[0].topic}" —Ç–∞“õ—ã—Ä—ã–±—ã–Ω —Ç–æ–ª—ã“õ –º–µ“£–≥–µ—Ä–º–µ–≥–µ–Ω—Å—ñ–∑. 
                –ñ–æ“ì–∞—Ä—ã–¥–∞“ì—ã –º–∏–∫—Ä–æ-—Å–∞–±–∞“õ –æ—Å—ã –æ–ª“õ—ã–ª—ã“õ—Ç—ã —Ç–æ–ª—Ç—ã—Ä—É“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ.</p>
            </div>
        `;
    } else {
        microLessonHtml += `
            <div style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 8px; border-left: 4px solid var(--success);">
                <strong>‚úÖ –ñ–∞“õ—Å—ã –∂“±–º—ã—Å!</strong>
                <p>–°—ñ–∑ –±“±–ª —Ç–∞“õ—ã—Ä—ã–ø—Ç—ã –∂”ô–Ω–µ –æ–Ω—ã“£ –∞–ª–¥—ã“£“ì—ã —Å—ã–Ω—ã–ø—Ç–∞—Ä–¥–∞“ì—ã –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ–Ω –∂–∞“õ—Å—ã —Ç“Ø—Å—ñ–Ω–µ—Å—ñ–∑. 
                –ë—ñ—Ä–∞“õ –±—ñ–ª—ñ–º –≥—Ä–∞—Ñ—ã–Ω “õ–∞—Ä–∞–ø, –±—ñ–ª—ñ–º—ñ“£—ñ–∑–¥—ñ —Ç–µ—Ä–µ“£–¥–µ—Ç—É–≥–µ –±–æ–ª–∞–¥—ã.</p>
            </div>
        `;
    }
    
    document.getElementById('kgMicroLesson').innerHTML = microLessonHtml;
    
    // Scroll to knowledge graph
    kgElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function getHint() {
    const data = retestMode ? retestQuestions[retestCurrentIndex] : db[currentGrade][currentIndex];
    const topic = data.t;
    
    // Show knowledge graph instead of regular hint
    showKnowledgeGraph(topic, false);
    
    document.getElementById('aiMessage').innerHTML = 
        `<strong>${topic} —Ç–∞“õ—ã—Ä—ã–±—ã–Ω—ã“£ –±—ñ–ª—ñ–º –≥—Ä–∞—Ñ—ã–Ω –∫”©—Ä—Å–µ—Ç–µ–º—ñ–Ω:</strong><br>
        –ë“±–ª —Ç–∞“õ—ã—Ä—ã–ø “õ–∞–Ω–¥–∞–π –∞–ª–¥—ã“£“ì—ã –±—ñ–ª—ñ–º–¥–µ—Ä–≥–µ –Ω–µ–≥—ñ–∑–¥–µ–ª–µ—Ç—ñ–Ω—ñ–Ω “õ–∞—Ä–∞“£—ã–∑.`;
}

function check(idx, el) {
    if (!canClick) return;
    canClick = false;
    
    let data, correct, isCorrect;
    
    if (retestMode) {
        data = retestQuestions[retestCurrentIndex];
        correct = data.a;
        isCorrect = idx === correct;
        
        if (isCorrect) {
            retestScore++;
        }
    } else {
        data = db[currentGrade][currentIndex];
        correct = data.a;
        isCorrect = idx === correct;
        
        // Record wrong answer for analysis
        if (!isCorrect) {
            wrongAnswers.push({
                topic: data.t,
                question: data.q,
                yourAnswer: data.o[idx],
                correctAnswer: data.o[correct],
                grade: currentGrade,
                options: data.o,
                correctIndex: correct
            });
        }
        
        if (isCorrect) {
            score++;
        }
    }
    
    // Show correct/wrong styling
    if (isCorrect) {
        el.classList.add('correct');
    } else {
        el.classList.add('wrong');
        document.getElementById('options').children[correct].classList.add('correct');
    }
    
    // Show knowledge graph for deeper understanding
    setTimeout(() => {
        showKnowledgeGraph(data.t, isCorrect);
        
        // Update AI message with explanation
        const explanation = getExplanation(data.t, data.q, data.o[correct], isCorrect);
        document.getElementById('aiMessage').innerHTML = explanation;
        
        // Set timeout for next question
        setTimeout(() => {
            if (knowledgeGraphVisible) {
                // If user is viewing knowledge graph, wait for button click
                const nextBtn = document.createElement('button');
                nextBtn.className = 'ai-hint-btn';
                nextBtn.innerHTML = '–ö–µ–ª–µ—Å—ñ —Å“±—Ä–∞“õ“õ–∞ ”©—Ç—É ‚Üí';
                nextBtn.onclick = () => {
                    nextQuestion();
                    nextBtn.remove();
                };
                document.getElementById('aiMessage').innerHTML += '<br><br>';
                document.getElementById('aiMessage').appendChild(nextBtn);
            } else {
                nextQuestion();
            }
        }, 2000);
    }, 1000);
}

function nextQuestion() {
    if (retestMode) {
        retestCurrentIndex++;
        if (retestCurrentIndex < retestQuestions.length) {
            showQuestion();
        } else {
            showRetestResults();
        }
    } else {
        currentIndex++;
        if (currentIndex < 10) {
            showQuestion();
        } else {
            showResults();
        }
    }
}

function getExplanation(topic, question, correctAnswer, isCorrect) {
    const explanations = {
        "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è": `‚úÖ <strong>sin¬≤x + cos¬≤x = 1</strong> - –±“±–ª –Ω–µ–≥—ñ–∑–≥—ñ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è–ª—ã“õ —Å”ô–π–∫–µ—Å—Ç—ñ–∫.<br>
                         –û–ª –ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã–Ω–∞–Ω —à—ã“ì–∞–¥—ã: —Ç—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç–∞ –≥–∏–ø–æ—Ç–µ–Ω—É–∑–∞–Ω—ã“£ –∫–≤–∞–¥—Ä–∞—Ç—ã –∫–∞—Ç–µ—Ç—Ç–µ—Ä –∫–≤–∞–¥—Ä–∞—Ç—Ç–∞—Ä—ã–Ω—ã“£ “õ–æ—Å—ã–Ω–¥—ã—Å—ã–Ω–∞ —Ç–µ“£.`,
        "–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É": `‚úÖ <strong>x¬≤ - a¬≤ = 0</strong> —Ç–µ“£–¥–µ—É—ñ (x-a)(x+a)=0 —Ç“Ø—Ä—ñ–Ω–¥–µ –∂–∞–∑—ã–ª–∞–¥—ã.<br>
                          –î–µ–º–µ–∫, x = a –Ω–µ–º–µ—Å–µ x = -a. –ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É–¥—ñ“£ –µ–∫—ñ —Ç“Ø–±—ñ—Ä—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.`,
        "–õ–æ–≥–∞—Ä–∏—Ñ–º": `‚úÖ <strong>log‚Çê b = c</strong> –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ a·∂ú = b.<br>
                    –ú—ã—Å–∞–ª—ã, log‚ÇÇ 16 = 4, —Å–µ–±–µ–±—ñ 2‚Å¥ = 16.`,
        "–¢—É—ã–Ω–¥—ã": `‚úÖ –î”ô—Ä–µ–∂–µ–ª—ñ–∫ —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã“£ —Ç—É—ã–Ω–¥—ã—Å—ã: <strong>(x‚Åø)' = n¬∑x‚Åø‚Åª¬π</strong>.<br>
                  –ú—ã—Å–∞–ª—ã, (x¬≤)' = 2x, (x¬≥)' = 3x¬≤.`,
        "–ò–Ω—Ç–µ–≥—Ä–∞–ª": `‚úÖ <strong>‚à´ 1 dx = x + C</strong>, –º“±–Ω–¥–∞“ì—ã C - –∏–Ω—Ç–µ–≥—Ä–∞–ª–¥–∞—É —Ç“±—Ä–∞“õ—Ç—ã—Å—ã.<br>
                    –ë“±–ª —Ç—É—ã–Ω–¥—ã“ì–∞ –∫–µ—Ä—ñ –∞–º–∞–ª: (x + C)' = 1.`
    };
    
    const baseExplanation = explanations[topic] || 
        `–ë“±–ª —Å“±—Ä–∞“õ <strong>${topic}</strong> —Ç–∞“õ—ã—Ä—ã–±—ã–Ω–∞ –∂–∞—Ç–∞–¥—ã. –î“±—Ä—ã—Å –∂–∞—É–∞–ø: <strong>${correctAnswer}</strong>`;
    
    if (isCorrect) {
        return `‚úÖ <strong>–î“±—Ä—ã—Å!</strong><br>${baseExplanation}`;
    } else {
        return `‚ùå <strong>“ö–∞—Ç–µ.</strong> –î“±—Ä—ã—Å –∂–∞—É–∞–ø: <strong>${correctAnswer}</strong><br>${baseExplanation}`;
    }
}

function showResults() {
    document.getElementById('quizCard').style.display = 'none';
    const resCard = document.getElementById('resultsCard');
    resCard.style.display = 'block';
    document.getElementById('finalScore').innerText = `${score}/10`;
    
    // Result message
    let msg = "";
    if (score === 10) msg = "–ö–µ—Ä–µ–º–µ—Ç! –°–µ–Ω –Ω–∞“ì—ã–∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫—Å—ñ“£! üåü";
    else if (score >= 7) msg = "”®—Ç–µ –∂–∞“õ—Å—ã –Ω”ô—Ç–∏–∂–µ! –ö”©–ø –Ω”ô—Ä—Å–µ–Ω—ñ –±—ñ–ª–µ—Å—ñ“£. üëç";
    else if (score >= 5) msg = "–ñ–∞“õ—Å—ã —Ç–∞–ª–ø—ã–Ω—ã—Å! –ö–µ–π–±—ñ—Ä —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä–¥—ã “õ–∞–π—Ç–∞–ª–∞—É –∫–µ—Ä–µ–∫. üìö";
    else msg = "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–Ω—ã –º–µ“£–≥–µ—Ä—É “Ø—à—ñ–Ω “õ–æ—Å—ã–º—à–∞ –∂–∞—Ç—Ç—ã“ì—É “õ–∞–∂–µ—Ç. –î–∞“£“õ “õ“±–ª–∞–º–∞–π–¥—ã! üí™";
    
    document.getElementById('resultMessage').innerText = msg;
    
    // Show weakness analysis with knowledge graph integration
    showWeaknessAnalysis();
    
    // Show retest banner if there are wrong answers
    if (wrongAnswers.length > 0) {
        document.getElementById('retestBanner').style.display = 'block';
        document.getElementById('wrongQuestionsCount').innerText = wrongAnswers.length;
        
        // Count unique topics
        const topics = new Set();
        wrongAnswers.forEach(item => topics.add(item.topic));
        document.getElementById('weakTopicsCount').innerText = topics.size;
    } else {
        document.getElementById('retestBanner').style.display = 'none';
    }
}

function startRetest() {
    retestMode = true;
    retestCurrentIndex = 0;
    retestScore = 0;
    
    // –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–µ—Ç–µ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–æ–∫
    retestQuestions = wrongAnswers.map(item => ({
        q: item.question,
        o: item.options,
        a: item.correctIndex,
        t: item.topic
    }));
    
    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
    retestQuestions = shuffleArray(retestQuestions);
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (–º–∞–∫—Å–∏–º—É–º 10)
    if (retestQuestions.length > 10) {
        retestQuestions = retestQuestions.slice(0, 10);
    }
    
    // –ü—Ä—è—á–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç
    document.getElementById('resultsCard').style.display = 'none';
    document.getElementById('quizCard').style.display = 'block';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ AI –¥–ª—è —Ä–µ—Ç–µ—Å—Ç–∞
    document.getElementById('aiMessage').innerHTML = 
        `üéØ <strong>“ö–∞—Ç–µ–ª–µ—Ä –±–æ–π—ã–Ω—à–∞ —Ç–µ—Å—Ç –±–∞—Å—Ç–∞–ª–¥—ã!</strong><br>
        –°—ñ–∑ –±“±—Ä—ã–Ω “õ–∞—Ç–µ–ª–µ—Å–∫–µ–Ω ${retestQuestions.length} —Å“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä–µ—Å—ñ–∑. 
        –û—Å—ã —Ç–µ—Å—Ç —Å—ñ–∑–¥—ñ“£ –±—ñ–ª—ñ–º—ñ“£—ñ–∑–¥—ñ –Ω—ã“ì–∞–π—Ç—É“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ.`;
    
    showQuestion();
}

function showRetestResults() {
    document.getElementById('quizCard').style.display = 'none';
    const resCard = document.getElementById('resultsCard');
    resCard.style.display = 'block';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ç–µ—Å—Ç–∞
    document.getElementById('finalScore').innerText = `${retestScore}/${retestQuestions.length}`;
    
    let msg = "";
    const percentage = (retestScore / retestQuestions.length) * 100;
    
    if (percentage === 100) msg = "–¢–∞–º–∞—à–∞! –°—ñ–∑ –±–∞—Ä–ª—ã“õ “õ–∞—Ç–µ–ª–µ—Ä—ñ“£—ñ–∑–¥—ñ —Ç“Ø–∑–µ—Ç—Ç—ñ“£—ñ–∑! üéâ";
    else if (percentage >= 70) msg = "”®—Ç–µ –∂–∞“õ—Å—ã! –°—ñ–∑ “õ–∞—Ç–µ–ª–µ—Ä—ñ“£—ñ–∑–¥—ñ“£ –∫”©–ø—à—ñ–ª—ñ–≥—ñ–Ω —Ç“Ø–∑–µ—Ç—Ç—ñ“£—ñ–∑! üëç";
    else if (percentage >= 50) msg = "–ñ–∞“õ—Å—ã! –°—ñ–∑ –ø—Ä–æ–≥—Ä–µ—Å–∫–µ “õ–æ–ª –∂–µ—Ç–∫—ñ–∑–¥—ñ“£—ñ–∑, –±—ñ—Ä–∞“õ —Ç–∞“ì—ã –¥–∞ –∂–∞—Ç—Ç—ã“ì—É “õ–∞–∂–µ—Ç. üìö";
    else msg = "“ö–∞—Ç–µ–ª–µ—Ä—ñ“£—ñ–∑–¥—ñ —Ç“Ø–∑–µ—Ç—É “Ø—à—ñ–Ω —Ç–∞“ì—ã –¥–∞ –∂–∞—Ç—Ç—ã“ì—É –∂–∞—Å–∞“£—ã–∑. –°—ñ–∑ –º“±–Ω—ã —ñ—Å—Ç–µ–π –∞–ª–∞—Å—ã–∑! üí™";
    
    document.getElementById('resultMessage').innerText = msg;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç
    showWeaknessAnalysis();
    
    // –ü—Ä—è—á–µ–º –±–∞–Ω–Ω–µ—Ä —Ä–µ—Ç–µ—Å—Ç–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω
    document.getElementById('retestBanner').style.display = 'none';
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–µ—Ç–µ—Å—Ç–∞
    const retestResultDiv = document.createElement('div');
    retestResultDiv.className = 'retest-banner';
    retestResultDiv.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
    retestResultDiv.innerHTML = `
        <h3>‚úÖ “ö–∞—Ç–µ–ª–µ—Ä —Ç–µ—Å—Ç—ñ –∞—è“õ—Ç–∞–ª–¥—ã!</h3>
        <p>–°—ñ–∑ ${retestScore} —Å“±—Ä–∞“õ“õ–∞ –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –±–µ—Ä–¥—ñ“£—ñ–∑ (${retestQuestions.length} —Å“±—Ä–∞“õ—Ç–∞–Ω).</p>
        <div style="margin: 20px 0;">
            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>–ë–∞—Å—Ç–∞–ø“õ—ã —Ç–µ—Å—Ç:</span>
                    <span>${score}/10</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>“ö–∞—Ç–µ–ª–µ—Ä —Ç–µ—Å—Ç—ñ:</span>
                    <span>${retestScore}/${retestQuestions.length}</span>
                </div>
            </div>
        </div>
        <p>–°—ñ–∑–¥—ñ“£ –±—ñ–ª—ñ–º—ñ“£—ñ–∑–¥—ñ“£ –ø—Ä–æ–≥—Ä–µ—Å—Å—ñ: <strong>+${Math.round((retestScore/retestQuestions.length - (10-score)/10) * 100)}%</strong></p>
    `;
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π "“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É"
    const restartBtn = document.querySelector('.btn-restart');
    resCard.insertBefore(retestResultDiv, restartBtn);
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function showWeaknessAnalysis() {
    const weaknessList = document.getElementById('weaknessList');
    weaknessList.innerHTML = '';
    
    const wrongAnswersToShow = retestMode ? [] : wrongAnswers;
    
    if (wrongAnswersToShow.length === 0) {
        weaknessList.innerHTML = `
            <div class="weakness-item" style="background: #e8f7ef;">
                <div class="weakness-topic">‚úÖ –ë–∞—Ä–ª—ã“õ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä–¥—ã –∂–∞“õ—Å—ã –º–µ“£–≥–µ—Ä–≥–µ–Ω—Å—ñ“£!</div>
                <p>–°–µ–Ω –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞–Ω—ã ”©—Ç–µ –∂–∞“õ—Å—ã —Ç“Ø—Å—ñ–Ω–µ—Å—ñ“£. –ö–µ–ª–µ—Å—ñ –¥–µ“£–≥–µ–π–≥–µ ”©—Ç—É–≥–µ –¥–∞–π—ã–Ω—Å—ã“£!</p>
                <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px;">
                    <strong>üéì –ë—ñ–ª—ñ–º –≥—Ä–∞—Ñ—ã“£—ã–∑:</strong>
                    <p>–°—ñ–∑–¥—ñ“£ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ –±—ñ–ª—ñ–º—ñ“£—ñ–∑ —Ç“±—Ç–∞—Å –∂”ô–Ω–µ —Ç—ã“ì—ã–∑ –±–∞–π–ª–∞–Ω—ã—Å“õ–∞–Ω. ”ò—Ä —Ç–∞“õ—ã—Ä—ã–ø—Ç—ã“£ –Ω–µ–≥—ñ–∑–¥–µ—Ä—ñ–Ω –∂–∞“õ—Å—ã –±—ñ–ª–µ—Å—ñ–∑.</p>
                </div>
            </div>
        `;
        return;
    }
    
    // Group wrong answers by topic
    const topics = {};
    wrongAnswersToShow.forEach(item => {
        if (!topics[item.topic]) {
            topics[item.topic] = [];
        }
        topics[item.topic].push(item);
    });
    
    // Create analysis for each weak topic
    for (const [topic, items] of Object.entries(topics)) {
        const weaknessDiv = document.createElement('div');
        weaknessDiv.className = 'weakness-item';
        
        const kgData = knowledgeGraph[topic];
        const hasKnowledgeGraph = !!kgData;
        
        let content = `<div class="weakness-topic">‚ö†Ô∏è ${topic} (${items.length} “õ–∞—Ç–µ)</div>`;
        content += `<p><strong>–ú”ô—Å–µ–ª–µ:</strong> ${items[0].question}</p>`;
        content += `<p><strong>–°–µ–Ω—ñ“£ –∂–∞—É–∞–±—ã“£:</strong> ${items[0].yourAnswer}</p>`;
        content += `<p><strong>–î“±—Ä—ã—Å –∂–∞—É–∞–ø:</strong> ${items[0].correctAnswer}</p>`;
        
        // Add knowledge graph if available
        if (hasKnowledgeGraph) {
            const prerequisites = kgData.prerequisites.map(p => 
                `${p.grade} —Å—ã–Ω—ã–ø: ${p.topic}`
            ).join(', ');
            
            content += `<div style="margin-top: 10px; padding: 10px; background: #e8f4ff; border-radius: 8px;">
                <strong>üìö –ë—ñ–ª—ñ–º –≥—Ä–∞—Ñ—ã:</strong>
                <p>–ë“±–ª —Ç–∞“õ—ã—Ä—ã–ø –º—ã–Ω–∞ –∞–ª–¥—ã“£“ì—ã –±—ñ–ª—ñ–º–¥–µ—Ä–≥–µ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω: ${prerequisites}</p>
                <button onclick="showTopicMicroLesson('${topic}')" 
                        style="margin-top: 5px; background: var(--info); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                    –ú–∏–∫—Ä–æ-—Å–∞–±–∞“õ—Ç—ã –∫”©—Ä—Å–µ—Ç—É
                </button>
            </div>`;
        }
        
        // Add personalized recommendation
        content += `<div style="margin-top: 15px; padding: 10px; background: #fff8e1; border-radius: 8px;">
            <strong>üéØ –ñ–µ–∫–µ–ª–µ–Ω–¥—ñ—Ä—ñ–ª–≥–µ–Ω “±—Å—ã–Ω—ã—Å:</strong><br>
            ${getPersonalizedRecommendation(topic, items.length)}
        </div>`;
        
        weaknessDiv.innerHTML = content;
        weaknessList.appendChild(weaknessDiv);
    }
}

function showTopicMicroLesson(topic) {
    const kgData = knowledgeGraph[topic];
    if (!kgData) return;
    
    const lessonWindow = window.open('', '_blank', 'width=800,height=600');
    lessonWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>${topic} - –ú–∏–∫—Ä–æ-—Å–∞–±–∞“õ</title>
            <style>
                body { font-family: 'Inter', sans-serif; padding: 20px; background: #f5f7fa; }
                .container { max-width: 700px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
                h1 { color: #4361ee; border-bottom: 2px solid #4361ee; padding-bottom: 10px; }
                .kg-formula { background: #f8f9ff; padding: 15px; border-radius: 10px; font-family: monospace; margin: 15px 0; border-left: 4px solid #4361ee; }
                .prereq { background: #eef2ff; padding: 10px; border-radius: 8px; margin: 10px 0; }
                .grade-badge { background: #4361ee; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>${topic} - –¢–æ–ª—ã“õ –º–∏–∫—Ä–æ-—Å–∞–±–∞“õ</h1>
                <div style="margin-bottom: 20px;">
                    <strong>–ê–ª–¥—ã“£“ì—ã —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä:</strong>
                    ${kgData.prerequisites.map(p => `
                        <div class="prereq">
                            <span class="grade-badge">${p.grade} —Å—ã–Ω—ã–ø</span>
                            <strong>${p.topic}</strong>: ${p.connection}
                        </div>
                    `).join('')}
                </div>
                ${kgData.microLesson}
                <div style="margin-top: 30px; padding: 15px; background: #e8f7ef; border-radius: 10px;">
                    <strong>‚úÖ –ü—Ä–∞–∫—Ç–∏–∫–∞–ª—ã“õ –∫–µ“£–µ—Å:</strong>
                    <p>–û—Å—ã —Ç–∞“õ—ã—Ä—ã–ø—Ç—ã –º–µ“£–≥–µ—Ä—É “Ø—à—ñ–Ω:</p>
                    <ol>
                        <li>–ñ–æ“ì–∞—Ä—ã–¥–∞“ì—ã —Ñ–æ—Ä–º—É–ª–∞–ª–∞—Ä–¥—ã –∂–∞—Ç—Ç–∞“£—ã–∑</li>
                        <li>”ò—Ä —Ñ–æ—Ä–º—É–ª–∞“ì–∞ 3-4 –º—ã—Å–∞–ª —à—ã“ì–∞—Ä—ã“£—ã–∑</li>
                        <li>–ê–ª–¥—ã“£“ì—ã —Å—ã–Ω—ã–ø—Ç–∞—Ä–¥—ã“£ –æ“õ—É–ª—ã“õ—Ç–∞—Ä—ã–Ω “õ–∞–π—Ç–∞ “õ–∞—Ä–∞“£—ã–∑</li>
                        <li>–ö“Ø–Ω–¥–µ–ª—ñ–∫—Ç—ñ 15 –º–∏–Ω—É—Ç –∂–∞—Ç—Ç—ã“ì—É –∂–∞—Å–∞“£—ã–∑</li>
                    </ol>
                </div>
            </div>
        </body>
        </html>
    `);
    lessonWindow.document.close();
}

function getPersonalizedRecommendation(topic, errorCount) {
    const recommendations = {
        "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è": `–°—ñ–∑–≥–µ 8-9 —Å—ã–Ω—ã–ø—Ç–∞—Ä–¥—ã“£ –≥–µ–æ–º–µ—Ç—Ä–∏—è—Å—ã–Ω “õ–∞–π—Ç–∞–ª–∞—É “±—Å—ã–Ω—ã–ª–∞–¥—ã. 
                         –¢—ñ–∫–±“±—Ä—ã—à—Ç—ã “Ø—à–±“±—Ä—ã—à—Ç–∞—Ä –º–µ–Ω –ü–∏—Ñ–∞–≥–æ—Ä —Ç–µ–æ—Ä–µ–º–∞—Å—ã–Ω —Ç“Ø—Å—ñ–Ω—É –º–∞“£—ã–∑–¥—ã. 
                         ${errorCount > 1 ? '–ë“±–ª —Å—ñ–∑–¥—ñ“£ –Ω–µ–≥—ñ–∑–≥—ñ ”ô–ª—Å—ñ–∑–¥—ñ–≥—ñ“£—ñ–∑ –±–æ–ª—ã–ø —Ç–∞–±—ã–ª–∞–¥—ã.' : ''}`,
        
        "–ö–≤–∞–¥—Ä–∞—Ç —Ç–µ“£–¥–µ—É": `7-8 —Å—ã–Ω—ã–ø—Ç–∞—Ä–¥—ã“£ –∞–ª–≥–µ–±—Ä–∞—Å—ã–Ω “õ–∞–π—Ç–∞–ª–∞“£—ã–∑. 
                          –ö”©–±–µ–π—Ç–∫—ñ—à—Ç–µ—Ä–≥–µ –∂—ñ–∫—Ç–µ—É –∂”ô–Ω–µ –∫–≤–∞–¥—Ä–∞—Ç —Ç“Ø–±—ñ—Ä —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä—ã–Ω–∞ –Ω–∞–∑–∞—Ä –∞—É–¥–∞—Ä—ã“£—ã–∑.`,
        
        "–õ–æ–≥–∞—Ä–∏—Ñ–º": `–î”ô—Ä–µ–∂–µ–ª–µ—Ä —Ç–∞“õ—ã—Ä—ã–±—ã–Ω “õ–∞–π—Ç–∞–ª–∞“£—ã–∑ (9 —Å—ã–Ω—ã–ø). 
                    –õ–æ–≥–∞—Ä–∏—Ñ–º - –¥”ô—Ä–µ–∂–µ–Ω—ñ“£ –∫–µ—Ä—ñ –∞–º–∞–ª—ã –µ–∫–µ–Ω—ñ–Ω —Ç“Ø—Å—ñ–Ω—ñ“£—ñ–∑.`,
        
        "–¢—É—ã–Ω–¥—ã": `–§—É–Ω–∫—Ü–∏—è “±“ì—ã–º—ã–Ω –∂”ô–Ω–µ ”©–∑–≥–µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω “õ–∞–π—Ç–∞–ª–∞“£—ã–∑. 
                  –¢—É—ã–Ω–¥—ã–Ω—ã“£ —Ñ–∏–∑–∏–∫–∞–ª—ã“õ –º–∞“ì—ã–Ω–∞—Å—ã–Ω —Ç“Ø—Å—ñ–Ω—É –º–∞“£—ã–∑–¥—ã.`,
        
        "–ò–Ω—Ç–µ–≥—Ä–∞–ª": `–ê–ª–¥—ã–º–µ–Ω —Ç—É—ã–Ω–¥—ã–Ω—ã –∂–∞“õ—Å—ã –º–µ“£–≥–µ—Ä—É –∫–µ—Ä–µ–∫. 
                    –ò–Ω—Ç–µ–≥—Ä–∞–ª - —Ç—É—ã–Ω–¥—ã“ì–∞ –∫–µ—Ä—ñ –∞–º–∞–ª –µ–∫–µ–Ω—ñ–Ω —Ç“Ø—Å—ñ–Ω—ñ“£—ñ–∑.`
    };
    
    return recommendations[topic] || 
        `–ë“±–ª —Ç–∞“õ—ã—Ä—ã–ø—Ç—ã –º“±“õ–∏—è—Ç –æ“õ—ã–ø —à—ã“ì—ã“£—ã–∑. –§–æ—Ä–º—É–ª–∞–ª–∞—Ä–¥—ã –∂–∞—Ç—Ç–∞“£—ã–∑ –∂”ô–Ω–µ –∫”©–ø—Ç–µ–≥–µ–Ω –º—ã—Å–∞–ª–¥–∞—Ä —à—ã“ì–∞—Ä—ã“£—ã–∑.`;
}

// Initialize quiz
startQuiz(10);
</script>
</body>
</html>